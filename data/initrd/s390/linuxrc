#!/bin/bash
[ -f /etc/suse.motd ] && cat /etc/suse.motd
# echo 'This is SuSE Instsys Version %{version} Rel. %{release}'
# echo 'Build date: Thu Jul 25 15:12:53 CEST 2002'
export PATH=/sbin:/bin:/usr/sbin:/usr/bin
#
#
#
chmod +x /linuxrc
function movetotmpfs
{
    mkdir newroot
    mount -t shm -onr_inodes=10240 shmfs /newroot
    cp -ax / newroot
    cd newroot
    mv newroot oldroot.old
    pivot_root . oldroot.old
    exec chroot . /linuxrc <dev/console >dev/console 2>&1
}
if test -d oldroot.old
then
    umount /oldroot.old
    freeramdisk /dev/ram0
    mv oldroot.old oldroot
elif test \! -d oldroot
then
    movetotmpfs
fi
#
echo done doing movetotmpfs
#
#
#
if [ -d /var/log/YaST2 ]
then
	for i in  "y2log y2log-1 y2log-2 y2log-3 y2log-4 y2start.log"
	do
		touch /var/log/YaST2/$i
	done
fi
#
#	Main
#
mount -t devpts devpts /dev/pts
#
#	Kmod has a problem. call modprobe here
#
/sbin/modprobe cramfs
/sbin/modprobe ipv6
#
#
#
[ ! -f /proc/version ] && mount -t proc virtual-proc-filesystem /proc
#
#	Check the memory. If less than 256 Mb issue a warning.
#
set -- `cat /proc/meminfo | head -2 | tail -1`
if [ ${#2} -lt 10 ]
then
	let MEM="$2/1024/1024"
	if [ $MEM -lt 240 ]; then
		echo "A total of 256 MB ram is recommended for installation."
		echo "currently are only $MEM MB ram installed"
	fi
fi
#
#	Konfiguring the network
#
. /bin/netsetup
#
#	Check for DASD-Parameter and if present
#	write it into netsetup.inf
#
[ ! -z "$DASD_Parameter" ] && echo "DASD_Parameter: $DASD_Parameter" >> /etc/netsetup.inf
#
#	Ask for Installation source & start yast
#
[ $EXIT_SCRIPT -eq 0 ] && . /inst_source
#
#
#
dmesg > /kernel.msg
echo "
You should be able to login via telnet/ssh now.
To restart network setup, enter:

netsetup

To continue the installation, enter:

./inst_source
"
while bash -login
do echo "linuxrc $$: restarting bash"; sleep 1; done
